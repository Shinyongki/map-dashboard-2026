Development Spec v1.0
단계별 개발 명세서
경상남도 광역지원기관  |  개발자 전달용


# 0. 배경 및 현재 상태
경남 광역지원기관은 59개 수행기관의 노인맞춤돌봄서비스 현황을 관리하는 시스템을 개발 중이다. 현재 기관 현황 제출 시스템(React/TypeScript/Vite + Google Sheets API)과 지도 시각화 대시보드(독립 프로젝트)가 개발 진행 중이다.
이 명세서는 기존 시스템을 기반으로 통합 인텔리전스 시스템으로 확장하는 4개 Phase의 개발 요구사항을 정의한다.


| 현재 개발된 것 | 이번 명세서에서 추가할 것 |
| --- | --- |
| 기관 현황 입력 시스템 (4단계 위자드) | 기관코드 기반 권한 시스템 (JWT 연동) |
| Firebase Firestore/Storage 연동 | Gemini 1.5 기반 지능형 질의응답 |
| 지도 시각화 대시보드 (8종 모드) | 복지자원 연결망 및 경로 추천 |
| 기상/재난 탭 (설계 완료) | 기상+돌봄 통합 뷰, 이상치 감지 |
| PDF 텍스트 추출 파이프라인 | AI 브리핑 + 보고서 초안 생성 |




# Phase 1. 기반 구축
목표: 권한 시스템 + 공문서 질의응답 MVP 오픈

## 1-1. 기관코드 기반 권한 시스템
요구사항
기존 시군 선택 방식을 기관코드 입력 방식으로 전환
기관코드 검증은 서버 레벨에서만 수행
코드 검증 후 해당 기관의 시군, 기관명, 거점여부 자동 로드
세션 유지 (로컬스토리지 또는 쿠키, 만료 시간 설정)

구현 포인트
기관 마스터 테이블에 기관코드 컬럼 추가
로그인 API: POST /api/auth/institution { code } → { token, institutionInfo }
이후 모든 API 요청 헤더에 토큰 포함, 서버에서 기관코드 추출
광역 관리자는 기존 암호 인증 유지 (1672)


## 1-2. 지식 베이스 및 스토리지 구축
요구사항
- **Firebase Firestore** 연동: 공문(`documents`), 질문(`questions`) 컬렉션 생성
- **Firebase Storage** 연동: 공문 PDF 원본 저장 공간 확보
- 문서 텍스트 추출 엔진 구축 (`pdf-parse`)

구현 포인트
- 업로드 시 `documents` 폴더에 파일 저장 및 Signed URL 생성
- Firestore 문서 스키마: `title`, `documentNumber`, `content`, `aiSummary`, `fileUrl` 등
- 임베딩 생략형 RAG 또는 Gemini 1.5 Pro의 긴 컨텍스트(Long Context) 활용 전략 적용

## 1-3. 공문서 지능형 분석 및 Q&A MVP
요구사항 (광역 관리 기능)
- 공문 업로드 UI: 파일 선택 시 서버로 파일 스트림 전달
- **Gemini 1.5** 기반 자동 분석: 핵심 요약 + FAQ 초안 자동 생성
- FAQ 승인 및 공개 설정 워크플로우

요구사항 (현장 공개 기능)
- 활성 공문 목록 실시간 로드 (Firestore)
- 질문 입력 시 Gemini 기반 답변 생성: 관련 공문 텍스트를 컨텍스트로 주입
- 답변 출처 자동 표시: '○○ 공문 기준'

구현 포인트
- `pdf-parse`: 서버측 PDF 텍스트 추출 파이프라인
- Gemini 프롬프트 최적화: 공문 내용을 바탕으로 답변하도록 페르소나 설정
- FAQ 캐시: 질문의 키워드 매칭을 통한 LLM 호출 최적화



# Phase 2. 연결
목표: 복지자원 연결망 + 기상/돌봄 통합 뷰 구축

## 2-1. 복지자원 DB 고도화
요구사항
270개소 CSV 데이터 → RDB 마이그레이션
읍면동 단위 분류 (행정동 코드 기준)
서비스 유형 태깅 (요양원, 주간보호, 재가, 방문요양 등)
수행기관 ↔ 복지자원 연계 관계 매핑 테이블
지도 표시용 좌표 데이터 (카카오맵 또는 Geocoding API 활용)

구현 포인트
행정동 코드 기준 읍면동 분류 (행정안전부 표준 코드 사용)
신규 자원 등록 워크플로우: 현장 요청 → 광역 승인 → DB 등록
자원 연계 이력 테이블: resource_id, agency_code, date, result, note


## 2-2. 자원 경로 추천 엔진
요구사항
자연어 질의로 대상자 상황 입력: '퇴원 어르신, 창원시 의창구, 인지 저하'
조건 파싱 → RDB 검색 → 경로 구성 → LLM 자연어 설명
1차/2차/후속 연계 단계별 경로 제시
타 시군 참조 시 해당 기관 연락처 포함

구현 포인트
LLM으로 질의에서 파라미터 추출: 시군, 읍면동, 서비스 유형, 특이사항
검색 반경 확장 로직: 읍면동 → 시군 → 인근 시군 순
경로 추천 결과를 Vector DB에도 저장 (유사 사례 참조용)


## 2-3. 기상/재난 + 돌봄 통합 뷰
요구사항
기상청 특보 발령 시 해당 시군 돌봄 현황 자동 결합
통합 뷰: 특보 지역 + 독거노인 수 + 담당 종사자 수 + 인근 냉난방 시설
'지금 폭염 상황 브리핑' 자연어 질의 지원

구현 포인트
기상청 API 폴링 주기: 1시간 (특보 변경 시 즉시 반영)
시군 코드 기준으로 기상 데이터 ↔ 돌봄 현황 JOIN 쿼리
재난 이력 테이블: disaster_id, sigun_code, type, date, affected_agencies, service_impact



# Phase 3. 지능화
목표: 자동 감지 + 광역 브리핑 + 추세 분석

## 3-1. 이상치 자동 감지
요구사항
매월 제출 마감일 다음날 자동 실행 (배치)
감지 기준: 전월 대비 종사자 20% 이상 변동, 3개월 연속 추세, 신규 유입 0명
감지 결과 → 광역 대시보드 플래그 표시
(선택) 이메일 또는 카카오 알림톡 발송


## 3-2. 광역 일일 브리핑 자동 생성
요구사항
대시보드 접속 시 자동 표시되는 오늘의 브리핑
포함 내용: 미제출 기관 현황 / 이상치 감지 기관 / 활성 기상특보 / 미승인 FAQ 건수
LLM이 자연어 요약 생성 (단순 집계 목록이 아닌 서술형)

구현 포인트
브리핑 데이터 수집 쿼리 → LLM 프롬프트 구성 → 요약 생성
브리핑 캐시: 동일 데이터 기준 24시간 캐싱


## 3-3. 모니터링 방문 전 기관 브리핑
요구사항
기관코드 또는 기관명 입력 → 브리핑 자동 생성
포함 내용: 최근 3개월 종사자/대상자 추세, 이전 모니터링 지적사항, 미제출 이력, 재난 영향 여부
광역 담당자 전용 기능



# Phase 4. 고도화
목표: AI 보고서 초안 + 자원 발굴 순환 구조 + 지식 자산화

## 4-1. AI 보고서 초안 자동 생성
요구사항
월간 결과 보고서 초안: 전체 제출 현황 + 주요 이슈 + 시군별 분석
기관 평가 의견서 초안: 기관코드 입력 → 시계열 데이터 기반 생성
모니터링 결과 보고서 초안: 방문 기록 입력 → 공식 양식으로 변환

구현 포인트
보고서 양식 템플릿 → LLM 프롬프트에 구조 지정
생성 결과 HWP 또는 DOCX 다운로드 지원


## 4-2. 복지자원 발굴 순환 구조
요구사항
현장 사회복지사가 타 시군 자원 참조 후 '신규 자원 등록 요청' 버튼
광역 담당자 검토 → 승인 → DB 자동 등록
신규 등록 자원은 전체 현장에 즉시 공개
분기별 '이달의 발굴 자원' 통계 제공


## 4-3. 공문 작성 개선 피드백
요구사항
공문별 질의 건수 및 주요 질의 패턴 분석
'질의가 많은 공문 Top 5' 리포트 자동 생성
LLM이 해당 공문의 불명확한 부분 분석 → 개선 제안



# 공통 기술 가이드

## LLM 프롬프트 설계 원칙
시스템 프롬프트에 사용자 권한(광역/현장)과 기관코드를 항상 포함
현장 사용자 답변에는 타 기관 식별 정보 절대 포함 금지
답변 출처 명시: '○○ 공문 (발송일 기준)' 형식
불확실한 경우 '광역지원기관에 문의하세요' 안내 포함


## 비용 최적화 체크리스트
FAQ 캐시 히트율 모니터링 (목표: 70% 이상)
RAG 검색 청크 수 제한 (질의당 최대 5개)
브리핑 캐시 24시간 유지
현장 사용자 질의 범위 제한 (공문/자원 영역만)
월별 LLM 비용 모니터링 대시보드 구성


## 개발 우선순위 요약

| Phase | 핵심 기능 | 예상 효과 | 우선순위 |
| --- | --- | --- | --- |
| 1 | 권한 시스템 + 공문 질의응답 | 유선 문의 감소 | 최우선 |
| 2 | 복지자원 연결망 + 기상통합 뷰 | 자원 연계 효율화 | 높음 |
| 3 | 이상치 감지 + 브리핑 자동화 | 관리 업무 자동화 | 중간 |
| 4 | AI 보고서 + 발굴 순환 구조 | 지식 자산 축적 | 장기 |

